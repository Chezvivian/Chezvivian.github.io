---
title: '2025-04-03 Dify 智能助教应用 debug 过程'
tags:
  - thoughts
---


昨天刚和系里分享了在 Dify 上做的智能助教工作流，昨天晚上测试就一直报错，运行不了。今天 CAT 课前来办公室换了个阿里云调用的 DeepSeek大模型，结果还是不好。中午吃完饭溜达，也一直在看各个环节。终于，刚才从前几次 case 的 failure 细节里找到原因。

原来既不是调用的 API 没钱了（我看了DeepSeek的后台，上个月才花了不到1块钱），也不是 Dify 给我这个人用户卡脖子（因为并不限制外来 api 使用，也不会连续限制知识库的检索），原因竟然出在知识库检索里使用的 Rerank 模型。工作流的设定里，我只清楚记得问题分类、回答两个地方是分别调用了 api, 却忘了在知识库检索召回的时候，还有个 Rerank 模型的调用。这里我之前用的是百度的 bce-reranker, 看来之前工作流报错：run failed: [models] server unavailable error, open api daily request limit reached  多半是百度那边的api出了问题。幸好昨天调用的阿里云的大模型里有 rerank 的模型，先替换了一个，试运行，果然报错问题解决了。

再来看百度究竟是怎么回事。登录千帆的平台，才发现这两天百度大模型平台升级，把之前 access key/secret key 的认证模式改成了单 id 的方式，也就是说过去的方式没法调用服务了。估计这就是工作流从昨天晚上就开始掉线的原因。马上更换新的id, 但是 dify 还没有更新接口方式，那就先这样吧，阿里的用起来也是一样。

至此，一个紧急的 debug 结束。工作流的调试还在继续，毕竟大模型和知识库检索响应速度太慢了。如果一直这样，用户体验极差，学生们也不爱用了。

Problem solved.
